<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wonder What Is Tourism</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
          <a class="navbar-brand" href="/">WAIT</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
      
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="/index">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/vote">Vote</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/submit">Submit</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/view">View</a>
              </li>
            </ul>
          </div>
        </div>
    </nav>

    <div id="bannerCarousel" class="carousel slide" data-ride="carousel" data-interval="10000">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="https://images.unsplash.com/photo-1525625293386-3f8f99389edd?q=80&w=3904&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="First slide">
                <div class="carousel-caption">
                    <h1>Singapore</h1>
                    <p>An island country and city-state in maritime Southeast Asia</p>
                </div>
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="https://images.unsplash.com/photo-1501979376754-2ff867a4f659?q=80&w=3870&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Second slide">
                <div class="carousel-caption">
                    <h1>Boston, USA</h1>
                    <p>The cultural and financial center of the New England region</p>
                </div>
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?q=80&w=3870&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Third slide">
                <div class="carousel-caption">
                    <h1>Sydney, Australia</h1>
                    <p>A city of iconic attractions and brilliant beaches</p>
                </div>
            </div>
        </div>
        <a class="carousel-control-prev" href="#bannerCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#bannerCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>

    <main class="container-fluid">
        <section id="top-attractions" class="position-relative">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <h1 class="text-left">Top10 Attractions</h1>
                    <p class="text-left">What are the most popular tourist attractions?</p>
                </div>
                <a href="/submit" class="btn btn-secondary">Submit a new attraction</a>
            </div>
            <div>
                <ul id="voting-list"  class="list-group list-group-flush"></ul>
            </div>
        </section>

        <section id="comment" class="position-relative">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <h1 class="text-left">LATEST COMMENTS</h1>
                    <p class="text-left">Let's see what everyone's talking about.</p>
                </div>
                <a href="/vote" class="btn btn-secondary">Post your comments</a>
            </div>
            <div>
                <ul id="latest-comments" class="list-group list-group-flush"></ul>
            </div>
        </section>

        <section id="youtube">
            <h1 class="text-center">TINY TOURISM TOWNS</h1>
            <p class="text-center">Explore the attrations you're interested in.</p>
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <img class="d-block w-100" src="https://plus.unsplash.com/premium_photo-1677620333923-f687949bde38?q=80&w=3870&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="card-img-top" alt="Town 1">
                        <div class="card-body">
                            <h4 class="card-title">Coolgardie</h4>
                            <p class="card-text">Coolgardie hit the world map in 1892 as the birthplace of the gold rush that fuelled the largest mass migration of people in Australia's history....</p>
                            <a href="https://www.youtube.com/watch?v=cKq9T1xwiQw" target="_blank" class="btn btn-secondary position-absolute bottom-0 end-0 m-2">Explore</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <img class="d-block w-100" src="https://images.unsplash.com/photo-1514828260103-1e9bf9a58446?q=80&w=3870&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="card-img-top" alt="Town 2">
                        <div class="card-body">
                            <h4 class="card-title">Dwellingup</h4>
                            <p class="card-text">Embrace the spirit of adventure in the picturesque town of Dwellingup. Lace up your hiking boots and follow the bushwalking trails,...</p>
                            <a href="https://www.youtube.com/watch?v=UHxoSsLu_5Q" target="_blank" class="btn btn-secondary position-absolute bottom-0 end-0 m-2">Explore</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <img class="d-block w-100" src="https://images.unsplash.com/photo-1466500419182-8602dc906b51?q=80&w=3870&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="card-img-top" alt="Town 3">
                        <div class="card-body">
                            <h4 class="card-title">New Norcia</h4>
                            <p class="card-text">New Norcia is Australia's only monastic town, a historical and spiritual treasure in the West Australian bush. You won't believe what lies...</p>
                            <a href="https://www.youtube.com/watch?v=h-Wt-OKrUg4" target="_blank" class="btn btn-secondary position-absolute bottom-0 end-0 m-2">Explore</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        loadTopAttractions();

        function loadTopAttractions() {
            console.log('Loading top attractions...');
            fetch('/top_attractions') // Make sure this URL matches your Flask route
                .then(response => response.json())
                .then(data => {
                    updateAttractionList(data);
                })
                .catch(error => {
                    console.error('Failed to load comments:', error);
                    document.getElementById('voting-list').innerHTML = `<p>The comments could not be loaded, please try again later.</p>`;
                });
        }

        function updateAttractionList(attractions) {
            const listElement = document.getElementById('voting-list');
            listElement.innerHTML = ''; 

            if (attractions.length === 0) {
                listElement.innerHTML = `<p>Uh-oh, no one submitted an attraction yet...</p>`;
            } else {
                attractions.forEach((attraction, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item';
                    listItem.innerHTML = `
                        <div class="row align-items-center">
                            <div class="col-md-2"><h5>#${index + 1}</h5></div>
                            <div class="col-md-2"><p>${attraction.name}</p></div>
                            <div class="col-md-2"><p>${attraction.country}</p></div>
                            <div class="col-md-2"><p>${attraction.city}</p></div>
                            <div class="col-md-2"><p>${attraction.category}</p></div>
                            <div class="col-md-2"><p>Vote: ${attraction.votes}</p></div>
                        </div>
                    `;
                    listElement.appendChild(listItem);
                });
            }
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
        loadComments(); // Load comments when the DOM is fully loaded

        // Function to load comments
        function loadComments() {
            console.log('Loading comments...');
            fetch('/latest_comments') // Fetch comments from the server
                .then(response => response.json())
                .then(data => {
                    updateComments(data); // Update the comments list with the loaded data
                })
                .catch(error => {
                    console.error('Failed to load comments:', error);
                    document.getElementById('latest-comments').innerHTML = `<p>The comments could not be loaded, please try again later.</p>`;
                });
        }

        // Function to update the comments list
        function updateComments(comments) {
            const commentsContainer = document.getElementById('latest-comments');
            commentsContainer.innerHTML = ''; // Clear the current comments list

            // Check if there are any comments
            if (comments.length === 0) {
                commentsContainer.innerHTML = `<p>Uh-oh, no one has commented on the attraction yet.</p>`;
            } else {
                // If there are comments, populate the comments list
                for (let i = 0; i < comments.length; i += 3) {
                    const row = document.createElement('div');
                    row.className = 'row';

                    for (let j = i; j < i + 3 && j < comments.length; j++) {
                        const comment = comments[j];
                        const commentItem = document.createElement('div');
                        commentItem.className = 'col-md-4 mb-3';
                        commentItem.innerHTML = `
                            <div class="comment-item">
                                <div><h5>${comment.attraction_name}</h5></div>
                                <div><h5>${comment.country}, ${comment.city}</h5></div>
                                <p>${comment.feedback}</p>
                                <p class="text-muted">${comment.timestamp}</p>
                            </div>
                        `;
                        row.appendChild(commentItem);
                    }

                    commentsContainer.appendChild(row);
                }
            }
        }
    });
    </script>

</body>
</html>